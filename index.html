<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Add to Calendar</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; text-align: center; padding: 40px 20px; background: #f4f7f9; color: #333; }
        .card { background: white; padding: 30px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 380px; margin: auto; }
        h2 { margin: 0 0 8px 0; color: #000; font-size: 24px; }
        .date-display { color: #666; font-size: 18px; margin-bottom: 5px; font-weight: 500; }
        .time-display { color: #888; font-size: 16px; margin-bottom: 25px; }
        .btn { display: block; padding: 16px; margin: 12px 0; border-radius: 12px; text-decoration: none; font-weight: bold; color: white; font-size: 16px; }
        .outlook { background: #0078d4; }
        .google { background: #34a853; }
        .default { background: #555; }
    </style>
</head>
<body>
    <div class="card">
        <h2 id="title">Event Name</h2>
        <div id="dateRow" class="date-display"></div>
        <div id="timeRow" class="time-display"></div>
        <p id="locRow" style="color: #666; margin-bottom: 20px;"></p>
        
        <a id="outLink" class="btn outlook" href="#">Add to Outlook</a>
        <a id="gooLink" class="btn google" href="#">Add to Google</a>
        <a id="icsLink" class="btn default" href="#">Add to Default Calendar</a>
    </div>

   <script>
    const p = new URLSearchParams(window.location.search);
    const title = p.get('t') || "New Event";
    const startRaw = p.get('s') || "20260203T160000"; 
    const endRaw = p.get('e') || "20260203T170000";
    const loc = p.get('l') || "Location TBD";

    // Format for Display on the landing page
    const year = startRaw.substring(0,4);
    const month = startRaw.substring(4,6) - 1;
    const day = startRaw.substring(6,8);
    const dateObj = new Date(year, month, day);
    const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });

    // Helper to format ISO for Outlook (YYYY-MM-DDTHH:MM:SS)
    function toISO(raw) {
        return `${raw.substring(0,4)}-${raw.substring(4,6)}-${raw.substring(6,8)}T${raw.substring(9,11)}:${raw.substring(11,13)}:${raw.substring(13,15)}`;
    }

    const startISO = toISO(startRaw);
    const endISO = toISO(endRaw);

    document.getElementById('title').innerText = title;
    document.getElementById('dateRow').innerText = dayName;
    document.getElementById('locRow').innerText = "üìç " + loc;

    // 1. Outlook Link (Now using ISO format with dashes and colons)
    document.getElementById('outLink').href = `https://outlook.office.com/calendar/0/deeplink/compose?subject=${encodeURIComponent(title)}&startdt=${startISO}&enddt=${endISO}&location=${encodeURIComponent(loc)}`;
    
    // 2. Google Link
    document.getElementById('gooLink').href = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${startRaw}/${endRaw}&location=${encodeURIComponent(loc)}`;

    // 3. Default Calendar
    const icsData = `BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nSUMMARY:${title}\nDTSTART:${startRaw}\nDTEND:${endRaw}\nLOCATION:${loc}\nEND:VEVENT\nEND:VCALENDAR`;
    document.getElementById('icsLink').href = "data:text/calendar;charset=utf8," + encodeURIComponent(icsData);
</script>
</body>
</html>
